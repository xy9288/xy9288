(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d2304f1"],{ec74:function(t,a,e){"use strict";e.r(a);e("a4d3"),e("e01a");var i=function(){var t=this,a=t._self._c;return a("div",[a("a-form-model",{ref:"ruleForm",attrs:{model:t.modal,layout:"vertical",rules:t.rules}},[a("a-card",{staticStyle:{"margin-bottom":"20px"},attrs:{bordered:!1,"body-style":{padding:"17px 24px"}}},[a("a-row",[a("a-col",{staticStyle:{"font-size":"16px","font-weight":"bold",color:"rgba(0, 0, 0, 0.85)","padding-top":"4px"},attrs:{span:12}},[t._v(" "+t._s(t.modal.scriptId?"编辑":"新建")+t._s(t.scriptLanguageName)+"脚本 ")]),a("a-col",{staticStyle:{"text-align":"right"},attrs:{span:12}},[a("a-space",{attrs:{size:"small"}},[a("a-button",{staticStyle:{width:"75px"},on:{click:t.onClose}},[t._v(" 返回")]),a("a-button",{staticStyle:{width:"75px"},attrs:{type:"primary"},on:{click:t.saveScript}},[t._v(" 保存")])],1)],1)],1)],1),a("a-row",{attrs:{gutter:24}},[a("a-col",{attrs:{span:16}},[a("a-card",{attrs:{bordered:!1,"body-style":{paddingBottom:0}}},[a("a-row",{attrs:{gutter:24}},[a("a-col",{attrs:{span:12}},[a("a-form-model-item",{attrs:{label:"名称",prop:"scriptName"}},[a("a-input",{attrs:{placeholder:"请输入脚本名称"},model:{value:t.modal.scriptName,callback:function(a){t.$set(t.modal,"scriptName",a)},expression:"modal.scriptName"}})],1)],1),a("a-col",{attrs:{span:12}},[a("a-form-model-item",{attrs:{label:"说明",prop:"description"}},[a("a-input",{attrs:{placeholder:"请输入脚本说明"},model:{value:t.modal.description,callback:function(a){t.$set(t.modal,"description",a)},expression:"modal.description"}})],1)],1),a("a-col",{staticClass:"scriptModel",attrs:{span:24}},[a("a-form-model-item",{attrs:{label:t.scriptLanguageName+"脚本",prop:"scriptContent"}},[a("monaco-editor",{ref:"ScriptContentEditor",attrs:{height:"600px",minimap:!0,"auto-init":!1}})],1)],1)],1)],1)],1),a("a-col",{attrs:{span:8}},[a("a-card",{attrs:{title:"调试","body-style":{paddingBottom:0},bordered:!1}},[a("span",{attrs:{slot:"extra"},slot:"extra"},[a("a-button",{staticClass:"runBtn",attrs:{type:"primary",icon:"caret-right"},on:{click:t.runScript}},[t._v(" 运行 ")])],1),a("a-form-model-item",{staticClass:"inputModel",attrs:{label:"输入参数（Json）",prop:"paramContent"}},[a("monaco-editor",{ref:"ParamContentEditor",attrs:{height:"285px",language:"json"}})],1),a("a-form-model-item",{staticClass:"outputModel",attrs:{label:"运行结果",prop:"resultContent"}},[a("div",{staticStyle:{"margin-top":"-30px",width:"100%","text-align":"right",height:"30px",color:"#000000"}},[a("span",{directives:[{name:"show",rawName:"v-show",value:t.time>=0,expression:"time >= 0"}],staticStyle:{display:"inline-block","padding-right":"15px"}},[t._v("用时："+t._s(t.time)+"ms")])]),a("monaco-editor",{ref:"ResultContentEditor",attrs:{height:"285px",language:"json"}})],1)],1)],1)],1)],1)],1)},r=[],s=(e("b0c0"),e("2ca0"),e("ac1f"),e("1276"),e("d3b7"),e("0fea")),o=e("2200c"),n=e("01ff"),c={name:"ScriptModel",components:{MonacoEditor:o["a"]},data:function(){return{title:"操作",visible:!1,confirmLoading:!1,modal:{scriptContent:"",scriptLanguage:""},url:{info:"/api/script/info",add:"/api/script/add",update:"/api/script/update",testScript:"/api/rule/testScript"},rules:{scriptName:[{required:!0,message:"请输入脚本名称",trigger:"blur"}],scriptLanguage:[{required:!0,message:"请选择脚本语言",trigger:"change"}],scriptContent:[{required:!0,message:"请输入脚本内容",trigger:"blur"}]},time:-1,scriptLanguageMap:n["b"]}},computed:{scriptLanguageName:function(){return this.modal.scriptLanguage?this.scriptLanguageMap[this.modal.scriptLanguage].name:""}},mounted:function(){var t=this,a=this.$route.params.scriptId;if(a.startsWith("new")){var e=a.split("-");this.modal.scriptLanguage=e[1],this.modal.scriptContent=this.scriptLanguageMap[this.modal.scriptLanguage].default,this.initEditorValue()}else this.scriptId=a,Object(s["b"])(this.url.info,{scriptId:this.scriptId}).then((function(a){t.modal=a.data,t.initEditorValue()}))},methods:{initEditorValue:function(){var t=this;this.$nextTick((function(){t.$refs.ScriptContentEditor.init(t.modal.scriptContent,t.scriptLanguageMap[t.modal.scriptLanguage].editor),t.$refs.ParamContentEditor.set("{}"),t.$refs.ResultContentEditor.set("")}))},runScript:function(){var t=this,a={language:this.modal.scriptLanguage,script:this.$refs.ScriptContentEditor.get(),param:this.$refs.ParamContentEditor.get()};Object(s["c"])(this.url.testScript,a).then((function(a){200===a.code?(t.$refs.ResultContentEditor.set(JSON.stringify(a.data.result)),t.$refs.ResultContentEditor.format(),t.time=a.data.time,t.$message.success("运行成功")):t.$message.error("运行失败: "+a.message)}))},saveScript:function(){var t=this;this.modal.scriptContent=this.$refs.ScriptContentEditor.get();var a=this;this.$refs.ruleForm.validate((function(e){if(!e)return!1;a.confirmLoading=!0;var i,r=JSON.parse(JSON.stringify(t.modal));i=t.scriptId?Object(s["d"])(t.url.update,r):Object(s["c"])(t.url.add,r),i.then((function(t){200===t.code?(a.$message.success("保存成功"),a.modal=t.data):a.$message.warning("保存失败")})).finally((function(){a.confirmLoading=!1}))}))},onClose:function(){this.$router.push({name:"scriptList"})}}},l=c,p=e("2877"),d=Object(p["a"])(l,i,r,!1,null,null,null);a["default"]=d.exports}}]);