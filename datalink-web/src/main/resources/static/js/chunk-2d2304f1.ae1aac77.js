(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d2304f1"],{ec74:function(t,e,a){"use strict";a.r(e);a("a4d3"),a("e01a");var i=function(){var t=this,e=t._self._c;return e("div",[e("a-form-model",{ref:"ruleForm",attrs:{model:t.modal,layout:"vertical",rules:t.rules}},[e("a-card",{staticStyle:{"margin-bottom":"20px"},attrs:{bordered:!1,"body-style":{padding:"17px 24px"}}},[e("a-row",[e("a-col",{staticStyle:{"font-size":"16px","font-weight":"bold",color:"rgba(0, 0, 0, 0.85)","padding-top":"4px"},attrs:{span:12}},[t._v(" "+t._s(t.modal.scriptId?"编辑":"新建")+"脚本 ")]),e("a-col",{staticStyle:{"text-align":"right"},attrs:{span:12}},[e("a-space",{attrs:{size:"small"}},[e("a-popconfirm",{attrs:{title:"放弃未保存的内容?",placement:"bottom"},on:{confirm:function(){t.onClose()}}},[e("a-button",{staticStyle:{width:"75px"}},[t._v(" 返回")])],1),e("a-button",{staticStyle:{width:"95px"},on:{click:t.changeOpenTest}},[t._v(" "+t._s(t.openTest?"关闭":"开启")+"调试")]),e("a-button",{staticStyle:{width:"75px"},attrs:{type:"primary"},on:{click:t.saveScript}},[t._v(" 保存")])],1)],1)],1)],1),e("a-row",{attrs:{gutter:24}},[e("a-col",{attrs:{span:t.openTest?15:24}},[e("a-card",{attrs:{bordered:!1,"body-style":{paddingBottom:0}}},[e("a-row",{attrs:{gutter:24}},[e("a-col",{attrs:{span:9}},[e("a-form-model-item",{attrs:{label:"名称",prop:"scriptName"}},[e("a-input",{attrs:{placeholder:"请输入脚本名称"},model:{value:t.modal.scriptName,callback:function(e){t.$set(t.modal,"scriptName",e)},expression:"modal.scriptName"}})],1)],1),e("a-col",{attrs:{span:9}},[e("a-form-model-item",{attrs:{label:"说明",prop:"description"}},[e("a-input",{attrs:{placeholder:"请输入脚本说明"},model:{value:t.modal.description,callback:function(e){t.$set(t.modal,"description",e)},expression:"modal.description"}})],1)],1),e("a-col",{attrs:{span:6}},[e("a-form-model-item",{attrs:{label:"最后修改",prop:"description"}},[e("a-input",{attrs:{placeholder:"最后修改时间","read-only":!0},model:{value:t.modal.updateTime,callback:function(e){t.$set(t.modal,"updateTime",e)},expression:"modal.updateTime"}})],1)],1),e("a-col",{staticClass:"scriptModel",attrs:{span:24}},[e("a-form-model-item",{attrs:{label:"JavaScript脚本",prop:"scriptContent"}},[e("monaco-editor",{ref:"ScriptContentEditor",attrs:{height:"600px",minimap:!0}})],1)],1)],1)],1)],1),e("a-col",{directives:[{name:"show",rawName:"v-show",value:t.openTest,expression:"openTest"}],attrs:{span:9}},[e("a-card",{attrs:{title:"调试","body-style":{paddingBottom:0},bordered:!1}},[e("span",{attrs:{slot:"extra"},slot:"extra"},[e("a-button",{staticClass:"runBtn",attrs:{type:"primary",icon:"caret-right"},on:{click:t.runScript}},[t._v(" 运行 ")])],1),e("a-form-model-item",{staticClass:"inputModel",attrs:{label:"输入参数（Json）",prop:"paramContent"}},[e("monaco-editor",{ref:"ParamContentEditor",attrs:{height:"150px",language:"json"}})],1),e("a-form-model-item",{staticClass:"outputModel",attrs:{label:"运行结果",prop:"resultContent"}},[e("div",{staticStyle:{"margin-top":"-30px",width:"100%","text-align":"right",height:"30px",color:"#000000"}},[e("span",{directives:[{name:"show",rawName:"v-show",value:t.time>=0,expression:"time >= 0"}],staticStyle:{display:"inline-block","padding-right":"15px"}},[t._v("用时："+t._s(t.time)+"ms")])]),e("monaco-editor",{ref:"ResultContentEditor",attrs:{height:"150px",language:"json"}})],1),e("variables-model",{ref:"VariablesModel"})],1)],1)],1)],1)],1)},n=[],r=(a("d3b7"),a("0fea")),o=function(){var t=this,e=t._self._c;return e("a-form-model-item",{attrs:{label:"环境变量",prop:"variables"}},[e("div",{staticStyle:{"margin-top":"-30px",width:"100%","text-align":"right",height:"30px",color:"#000000","padding-top":"4px"}},[e("a",{on:{click:t.newItem}},[t._v("添加")])]),e("a-table",{staticStyle:{border:"1px #e8e3e3 solid"},attrs:{columns:t.columns,dataSource:t.data,pagination:!1,loading:t.loading,size:"small"},scopedSlots:t._u([t._l(["name","value"],(function(a,i){return{key:a,fn:function(n,r){return[r.editable?e("a-input",{key:a,staticStyle:{margin:"-5px 0"},attrs:{value:n,placeholder:t.columns[i].title},on:{change:function(e){return t.handleChange(e.target.value,r.key,a)}}}):[t._v(t._s(n))]]}}})),{key:"action",fn:function(a,i){return[i.editable?[i.isNew?e("span",[e("a",{on:{click:function(e){return t.saveRow(i)}}},[t._v("确定")]),e("a-divider",{attrs:{type:"vertical"}}),e("a-popconfirm",{attrs:{title:"删除此变量？"},on:{confirm:function(e){return t.remove(i.key)}}},[e("a",[t._v("删除")])])],1):e("span",[e("a",{on:{click:function(e){return t.saveRow(i)}}},[t._v("保存")]),e("a-divider",{attrs:{type:"vertical"}}),e("a",{on:{click:function(e){return t.cancel(i.key)}}},[t._v("取消")])],1)]:e("span",[e("a",{on:{click:function(e){return t.toggle(i.key)}}},[t._v("编辑")]),e("a-divider",{attrs:{type:"vertical"}}),e("a-popconfirm",{attrs:{title:"删除此变量？"},on:{confirm:function(e){return t.remove(i.key)}}},[e("a",[t._v("删除")])])],1)]}}],null,!0)})],1)},s=[],l=a("2909"),d=a("5530"),c=a("b85c"),u=(a("b64b"),a("b0c0"),a("25f0"),a("4de4"),a("7db0"),a("159b"),{name:"VariablesModel",data:function(){return{loading:!1,data:[],columns:[{title:"变量名",dataIndex:"name",key:"name",width:"40%",scopedSlots:{customRender:"name"}},{title:"变量值",dataIndex:"value",key:"value",width:"40%",scopedSlots:{customRender:"value"}},{title:"操作",key:"action",scopedSlots:{customRender:"action"}}]}},methods:{set:function(t){if(this.data=[],t)for(var e=Object.keys(t),a=1,i=0,n=e;i<n.length;i++){var r=n[i];this.data.push({key:a++,name:r,value:t[r],editable:!1,isNew:!1})}},get:function(){var t,e={},a=Object(c["a"])(this.data);try{for(a.s();!(t=a.n()).done;){var i=t.value;e[i.name]=i.value}}catch(n){a.e(n)}finally{a.f()}return e},newItem:function(){var t=this.data.length;this.data.push({key:0===t?"1":(parseInt(this.data[t-1].key)+1).toString(),name:"",value:"",editable:!0,isNew:!0})},remove:function(t){this.data=this.data.filter((function(e){return e.key!==t}))},saveRow:function(t){this.loading=!0;var e=t.key,a=t.name,i=t.value;if(!a||!i)return this.loading=!1,void this.$message.error("填写不完整");var n=this.data.find((function(t){return t.key===e}));n.editable=!1,n.isNew=!1,this.loading=!1},toggle:function(t){var e=this.data.find((function(e){return e.key===t}));e._originalData=Object(d["a"])({},e),e.editable=!e.editable},cancel:function(t){var e=this.data.find((function(e){return e.key===t}));Object.keys(e).forEach((function(t){e[t]=e._originalData[t]})),e._originalData=void 0},handleChange:function(t,e,a){var i=Object(l["a"])(this.data),n=i.find((function(t){return e===t.key}));n&&(n[a]=t,this.data=i)}}}),p=u,m=a("2877"),f=Object(m["a"])(p,o,s,!1,null,null,null),h=f.exports,v=a("2200c"),g={name:"ResourceModel",components:{MonacoEditor:v["a"],VariablesModel:h},data:function(){return{title:"操作",visible:!1,confirmLoading:!1,modal:{scriptContent:"/**\n* 方法名transform不可修改,入参：data Object 源数据,出参：data Object 目标数据\n*/\nfunction transform(data) {\n    return data;\n}",paramContent:"{}",resultContent:"",variables:{}},url:{info:"/api/script/info",add:"/api/script/add",update:"/api/script/update",run:"/api/script/run"},rules:{scriptName:[{required:!0,message:"请输入脚本名称",trigger:"blur"}],scriptContent:[{required:!0,message:"请输入脚本内容",trigger:"blur"}]},time:-1,openTest:!1}},mounted:function(){var t=this,e=this.$route.params.scriptId;"new"!==e?(this.scriptId=e,Object(r["b"])(this.url.info,{scriptId:this.scriptId}).then((function(e){t.modal=e.data,t.setEditorValue()}))):this.setEditorValue()},methods:{setEditorValue:function(){this.$refs.VariablesModel.set(this.modal.variables),this.$refs.ScriptContentEditor.set(this.modal.scriptContent),this.$refs.ParamContentEditor.set(this.modal.paramContent),this.$refs.ResultContentEditor.set(this.modal.resultContent)},getEditorValue:function(){this.modal.variables=this.$refs.VariablesModel.get(),this.modal.scriptContent=this.$refs.ScriptContentEditor.get(),this.modal.paramContent=this.$refs.ParamContentEditor.get(),this.modal.resultContent=this.$refs.ResultContentEditor.get()},runScript:function(){var t=this;this.getEditorValue(),Object(r["c"])(this.url.run,this.modal).then((function(e){200===e.code?(t.modal.resultContent=JSON.stringify(e.data.result),t.$refs.VariablesModel.set(e.data.variables),t.$refs.ResultContentEditor.set(t.modal.resultContent),t.time=e.data.time,t.$message.success("运行成功")):t.$message.error("运行失败: "+e.message)}))},saveScript:function(){var t=this;this.getEditorValue();var e=this;this.$refs.ruleForm.validate((function(a){if(!a)return!1;e.confirmLoading=!0;var i,n=JSON.parse(JSON.stringify(t.modal));i=t.scriptId?Object(r["d"])(t.url.update,n):Object(r["c"])(t.url.add,n),i.then((function(t){200===t.code?(e.$message.success("保存成功"),e.modal=t.data):e.$message.warning("保存失败")})).finally((function(){e.confirmLoading=!1}))}))},onClose:function(){this.$router.push({name:"scriptList"})},changeOpenTest:function(){this.openTest=!this.openTest}}},b=g,y=Object(m["a"])(b,i,n,!1,null,null,null);e["default"]=y.exports}}]);