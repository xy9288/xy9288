(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-36ceadd5"],{1871:function(e,t,o){"use strict";o("60a3")},"60a3":function(e,t,o){},d45d:function(e,t,o){"use strict";o.r(t);var r=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[o("a-card",{attrs:{title:"规则","body-style":{paddingBottom:0}}},[o("div",{attrs:{slot:"extra"},slot:"extra"},[o("a-button",{style:{marginRight:"8px"},attrs:{icon:"close"},on:{click:e.onClose}},[e._v(" 取消")]),o("a-button",{attrs:{type:"primary",icon:"save"},on:{click:e.saveRule}},[e._v(" 保存")])],1),o("a-row",{attrs:{gutter:20}},[o("a-form-model",{ref:"ruleForm",attrs:{model:e.modal,layout:"vertical",rules:e.rules}},[e.modal.ruleId?o("a-col",{attrs:{span:8}},[o("a-form-model-item",{attrs:{label:"ID",prop:"ruleId"}},[o("a-input",{attrs:{placeholder:"请输入规则ID",disabled:!0},model:{value:e.modal.ruleId,callback:function(t){e.$set(e.modal,"ruleId",t)},expression:"modal.ruleId"}})],1)],1):e._e(),o("a-col",{attrs:{span:e.modal.ruleId?8:12}},[o("a-form-model-item",{attrs:{label:"名称",prop:"ruleName"}},[o("a-input",{attrs:{placeholder:"请输入规则名称"},model:{value:e.modal.ruleName,callback:function(t){e.$set(e.modal,"ruleName",t)},expression:"modal.ruleName"}})],1)],1),o("a-col",{attrs:{span:e.modal.ruleId?8:12}},[o("a-form-model-item",{attrs:{label:"备注",prop:"description"}},[o("a-input",{attrs:{placeholder:"请输入备注"},model:{value:e.modal.description,callback:function(t){e.$set(e.modal,"description",t)},expression:"modal.description"}})],1)],1)],1)],1)],1),o("a-row",{staticStyle:{"margin-top":"20px"},attrs:{gutter:20}},[o("a-col",{attrs:{span:12}},[o("a-card",{attrs:{title:"数据源","body-style":{minHeight:"600px",paddingBottom:0}}},[o("a-row",{staticStyle:{"margin-bottom":"20px"},attrs:{gutter:20}},[o("a-col",{attrs:{span:12}},[e.modal.sourceResource&&void 0!==e.modal.sourceResource.resourceId?[o("a-card",[o("div",{attrs:{slot:"title"},slot:"title"},[e._v(e._s(e.modal.sourceResource.resourceName))]),o("a-row",{attrs:{gutter:16}},[o("a-col",{attrs:{span:8}},[o("div",[e._v("资源ID：")])]),o("a-col",{attrs:{span:16}},[o("div",[e._v(e._s(e.modal.sourceResource.resourceId))])])],1),o("a-row",{attrs:{gutter:16}},[o("a-col",{attrs:{span:8}},[o("div",[e._v("协议类型：")])]),o("a-col",{attrs:{span:16}},[o("div",[e._v(e._s(e.resourceTypeMap[e.modal.sourceResource.resourceType]))])])],1),o("a",{attrs:{slot:"actions"},on:{click:function(t){return e.editResource("source",e.modal.sourceResource)}},slot:"actions"},[e._v("配置")]),o("a-popconfirm",{attrs:{slot:"actions",title:"移除此资源?"},on:{confirm:function(){return e.deleteResource("source")}},slot:"actions"},[o("a",{attrs:{href:"javascript:;"}},[e._v("移除")])])],1)]:[o("a-button",{staticClass:"new-btn",staticStyle:{height:"194px",width:"100%"},attrs:{type:"dashed"},on:{click:function(t){return e.addResource("source")}}},[o("a-icon",{attrs:{type:"plus"}}),e._v(" 绑定数据源 ")],1)]],2),o("a-col",{attrs:{span:12}},[o("a-card",{directives:[{name:"show",rawName:"v-show",value:e.modal.sourceResource.resourceId,expression:"modal.sourceResource.resourceId"}],staticStyle:{height:"194px"},attrs:{title:"data",size:"small","body-style":{padding:"10px 20px"}}},[o("pre",[e._v(e._s(e.dataFormatMap[e.modal.sourceResource.resourceType]))])])],1)],1),o("a-form-model",{ref:"ruleForm",attrs:{model:e.modal,layout:"vertical",rules:e.rules}},[o("a-row",{attrs:{gutter:20}},[o("a-col",{attrs:{span:12}},[o("a-form-model-item",{attrs:{label:"解析方式",prop:"analysisMode"}},[o("a-select",{attrs:{placeholder:"请选择解析方式"},on:{change:e.analysisModeChange},model:{value:e.modal.analysisMode,callback:function(t){e.$set(e.modal,"analysisMode",t)},expression:"modal.analysisMode"}},[o("a-select-option",{attrs:{value:"WITHOUT"}},[e._v("无解析透传")]),o("a-select-option",{attrs:{value:"SCRIPT"}},[e._v("JavaScript脚本")]),o("a-select-option",{attrs:{value:"JAR"}},[e._v("Jar包")])],1)],1)],1),o("a-col",{attrs:{span:12}},[o("a-form-model-item",{attrs:{label:"忽略空值",prop:"ignoreNullValue"}},[o("a-select",{attrs:{placeholder:"请选择是否忽略空值"},model:{value:e.modal.ignoreNullValue,callback:function(t){e.$set(e.modal,"ignoreNullValue",t)},expression:"modal.ignoreNullValue"}},[o("a-select-option",{attrs:{value:!0}},[e._v("是")]),o("a-select-option",{attrs:{value:!1}},[e._v("否")])],1)],1)],1),o("a-col",{staticClass:"ruleModel",attrs:{span:24}},["SCRIPT"===e.modal.analysisMode?o("a-form-model-item",{attrs:{label:"解析脚本",prop:"script"}},[o("div",{staticStyle:{"margin-top":"-30px",width:"100%","text-align":"right",height:"30px","padding-top":"5px"}},[o("a",{on:{click:e.selectScript}},[e._v("选择脚本")])]),o("codemirror",{staticStyle:{border:"1px #e8e3e3 solid"},attrs:{options:e.options},model:{value:e.modal.script,callback:function(t){e.$set(e.modal,"script",t)},expression:"modal.script"}})],1):e._e()],1),o("a-col",{attrs:{span:24}},[o("a-form-model-item",{directives:[{name:"show",rawName:"v-show",value:"JAR"===e.modal.analysisMode,expression:"modal.analysisMode==='JAR'"}],attrs:{label:"Jar包地址",prop:"script"}},[o("a-input",{attrs:{placeholder:"请输入Jar包地址"}})],1)],1),o("a-col",{attrs:{span:24}},[o("a-form-model-item",{directives:[{name:"show",rawName:"v-show",value:"JAR"===e.modal.analysisMode,expression:"modal.analysisMode==='JAR'"}],attrs:{label:"解析类名",prop:"script"}},[o("a-input",{attrs:{placeholder:"请输入解析类名"}})],1)],1)],1)],1)],1)],1),o("a-col",{attrs:{span:12}},[o("a-card",{attrs:{title:"目标","body-style":{minHeight:"600px"}}},[o("a-list",{attrs:{grid:{gutter:24,lg:2,md:2,sm:2,xs:2},"data-source":e.modal.destResourceList},scopedSlots:e._u([{key:"renderItem",fn:function(t,r){return o("a-list-item",{},[t&&void 0!==t.resourceId?[o("a-card",[o("div",{attrs:{slot:"title"},slot:"title"},[e._v(e._s(t.resourceName))]),o("a-row",{attrs:{gutter:16}},[o("a-col",{attrs:{span:8}},[o("div",[e._v("资源ID：")])]),o("a-col",{attrs:{span:16}},[o("div",[e._v(e._s(t.resourceId))])])],1),o("a-row",{attrs:{gutter:16}},[o("a-col",{attrs:{span:8}},[o("div",[e._v("协议类型：")])]),o("a-col",{attrs:{span:16}},[o("div",[e._v(e._s(e.resourceTypeMap[t.resourceType]))])])],1),o("a",{attrs:{slot:"actions"},on:{click:function(o){return e.editResource("dest",t,r)}},slot:"actions"},[e._v("配置")]),o("a-popconfirm",{attrs:{slot:"actions",title:"移除此资源?"},on:{confirm:function(){return e.deleteResource("dest",r)}},slot:"actions"},[o("a",{attrs:{href:"javascript:;"}},[e._v("移除")])])],1)]:[o("a-button",{staticClass:"new-btn",staticStyle:{height:"194px",width:"100%"},attrs:{type:"dashed"},on:{click:function(t){return e.addResource("dest")}}},[o("a-icon",{attrs:{type:"plus"}}),e._v(" 添加目标资源 ")],1)]],2)}}])})],1)],1)],1),o("resource-model",{ref:"ResourceModel",on:{update:e.handleUpdateResource,add:e.handleAddResource}}),o("script-select-model",{ref:"ScriptSelectModel",on:{select:e.handleSelectedScript}})],1)},s=[],a=(o("a434"),o("d3b7"),o("0fea")),i=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("a-modal",{attrs:{confirmLoading:e.confirmLoading,title:"source"===e.resourceMode?"源数据":"目标资源",width:500,visible:e.visible},on:{cancel:e.onClose}},[o("a-form-model",{ref:"ruleForm",attrs:{model:e.modal,layout:"vertical",rules:e.rules}},[o("a-form-model-item",{attrs:{label:"类型",prop:"resourceType"}},[o("a-select",{attrs:{placeholder:"请选择资源类型"},on:{change:e.resourceTypeChange},model:{value:e.modal.resourceType,callback:function(t){e.$set(e.modal,"resourceType",t)},expression:"modal.resourceType"}},[o("a-select-option",{attrs:{value:"MQTT"}},[e._v("MQTT Broker")])],1)],1),o("a-form-model-item",{directives:[{name:"show",rawName:"v-show",value:e.modal.resourceType,expression:"modal.resourceType"}],attrs:{label:"资源",prop:"resourceId"}},[o("a-select",{attrs:{placeholder:"请选择资源"},on:{change:e.resourceChange},model:{value:e.modal.resourceId,callback:function(t){e.$set(e.modal,"resourceId",t)},expression:"modal.resourceId"}},e._l(e.resourceList,(function(t,r){return o("a-select-option",{key:r,attrs:{value:t.resourceId}},[e._v(" "+e._s(t.resourceName)+" ")])})),1)],1),"MQTT"===e.modal.resourceType?o("mqtt-properties",{ref:"PropertiesModal",attrs:{type:e.resourceMode}}):e._e()],1),o("div",{style:{position:"absolute",right:0,bottom:0,width:"100%",borderTop:"1px solid #e9e9e9",padding:"10px 16px",background:"#fff",textAlign:"right",zIndex:1}},[o("a-button",{style:{marginRight:"8px"},on:{click:e.onClose}},[e._v(" 取消")]),o("a-button",{attrs:{type:"primary"},on:{click:e.handleOk}},[e._v(" 确定")])],1)],1)},l=[],c=(o("c740"),function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("a-row",{attrs:{gutter:20}},[o("a-form-model",{attrs:{layout:"vertical",model:e.properties}},[o("a-col",{attrs:{span:24}},[o("a-form-model-item",{attrs:{label:"Topic"}},[o("a-input",{attrs:{placeholder:"请输入Topic"},model:{value:e.properties.topic,callback:function(t){e.$set(e.properties,"topic",t)},expression:"properties.topic"}})],1)],1),o("a-col",{attrs:{span:24}},[o("a-form-model-item",{attrs:{label:"Qos"}},[o("a-input-number",{staticStyle:{width:"100%"},attrs:{placeholder:"请输入Qos"},model:{value:e.properties.qos,callback:function(t){e.$set(e.properties,"qos",t)},expression:"properties.qos"}})],1)],1),o("a-col",{attrs:{span:12}},[o("a-form-model-item",{directives:[{name:"show",rawName:"v-show",value:"dest"===e.type,expression:"type==='dest'"}],attrs:{label:"动态Topic",prop:"dynamicTopic"}},[o("a-select",{attrs:{placeholder:"请选择是否动态Topic"},model:{value:e.properties.dynamicTopic,callback:function(t){e.$set(e.properties,"dynamicTopic",t)},expression:"properties.dynamicTopic"}},[o("a-select-option",{attrs:{value:!0}},[e._v("是")]),o("a-select-option",{attrs:{value:!1}},[e._v("否")])],1)],1)],1),o("a-col",{attrs:{span:12}},[o("a-form-model-item",{directives:[{name:"show",rawName:"v-show",value:"dest"===e.type,expression:"type==='dest'"}],attrs:{label:"消息保留",prop:"retained"}},[o("a-select",{attrs:{placeholder:"请选择是否消息保留"},model:{value:e.properties.retained,callback:function(t){e.$set(e.properties,"retained",t)},expression:"properties.retained"}},[o("a-select-option",{attrs:{value:!0}},[e._v("是")]),o("a-select-option",{attrs:{value:!1}},[e._v("否")])],1)],1)],1),o("a-col",{attrs:{span:24}},[o("a-form-model-item",{directives:[{name:"show",rawName:"v-show",value:"dest"===e.type,expression:"type==='dest'"}],staticStyle:{"margin-bottom":"0"},attrs:{label:"消息模板"}},[o("a-textarea",{attrs:{rows:6,placeholder:"消息模板"},model:{value:e.properties.template,callback:function(t){e.$set(e.properties,"template",t)},expression:"properties.template"}})],1)],1)],1)],1)}),n=[],d={data:function(){return{properties:{}}},props:{type:{type:String,default:void 0}},methods:{set:function(e){this.properties=e},get:function(){return this.properties}}},u=d,p=o("2877"),m=Object(p["a"])(u,c,n,!1,null,"a4eaaba0",null),f=m.exports,h={name:"ResourceModel",components:{MqttProperties:f},data:function(){return{title:"操作",visible:!1,confirmLoading:!1,modal:{},url:{resourceList:"/api/resource/list"},rules:{resourceType:[{required:!0,message:"请选择资源类型",trigger:"blur"}],resourceId:[{required:!0,message:"请选择资源",trigger:"blur"}]},resourceList:[],editMode:!0,resourceMode:null,resourceIndex:-1}},mounted:function(){},methods:{add:function(e){this.edit(e,{},-1),this.editMode=!1},edit:function(e,t,o){var r=this;this.resourceMode=e,this.resourceIndex=o,this.modal=JSON.parse(JSON.stringify(t)),this.visible=!0,this.$nextTick((function(){r.modal.resourceType&&(r.$refs.PropertiesModal.set(r.modal.properties),r.listResource(r.modal.resourceType))}))},listResource:function(e){var t=this;Object(a["b"])(this.url.resourceList,{resourceType:e}).then((function(e){t.resourceList=e.data}))},onClose:function(){this.visible=!1},handleOk:function(){var e=this,t=this;this.$refs.ruleForm.validate((function(o){o&&(t.confirmLoading=!0,t.modal.properties=t.$refs.PropertiesModal.get(),e.editMode?t.$emit("update",e.resourceMode,e.modal):t.$emit("add",e.resourceMode,e.modal,e.resourceIndex),t.confirmLoading=!1,t.visible=!1)}))},filterOption:function(e,t){return!!t.componentOptions.children[0].text&&t.componentOptions.children[0].text.toLowerCase().indexOf(e.toLowerCase())>=0},resourceTypeChange:function(e){this.modal={resourceType:e},this.listResource(e)},resourceChange:function(e){var t=this,o=this.resourceList.findIndex((function(t){return t.resourceId===e}));this.modal=this.resourceList[o],this.$nextTick((function(){t.modal.resourceType&&t.$refs.PropertiesModal.set(t.modal.properties)}))}}},v=h,g=Object(p["a"])(v,i,l,!1,null,"6ffc6fd1",null),b=g.exports,y=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("a-modal",{attrs:{confirmLoading:e.confirmLoading,title:"选择脚本",width:700,visible:e.visible},on:{cancel:e.onClose}},[o("a-table",{attrs:{columns:e.columns,"data-source":e.scriptList,size:"small",pagination:!1},scopedSlots:e._u([{key:"action",fn:function(t,r){return o("span",{},[o("a",{on:{click:function(t){return e.select(r)}}},[e._v("使用")])])}}])}),o("div",{style:{position:"absolute",right:0,bottom:0,width:"100%",borderTop:"1px solid #e9e9e9",padding:"10px 16px",background:"#fff",textAlign:"right",zIndex:1}},[o("a-button",{style:{marginRight:"8px"},on:{click:e.onClose}},[e._v(" 取消")])],1)],1)},x=[],_={name:"ScriptSelectModel",components:{},data:function(){return{visible:!1,confirmLoading:!1,url:{script:"/api/script/list"},columns:[{title:"ID",dataIndex:"scriptId"},{title:"名称",dataIndex:"scriptName"},{title:"操作",dataIndex:"action",scopedSlots:{customRender:"action"}}],scriptList:[]}},methods:{show:function(){this.getScriptList(),this.visible=!0},onClose:function(){this.visible=!1},getScriptList:function(){var e=this;Object(a["b"])(this.url.script,{}).then((function(t){200===t.code&&(e.scriptList=t.data)}))},select:function(e){this.$emit("select",e),this.visible=!1}}},R=_,T=Object(p["a"])(R,y,x,!1,null,"7ecaaf16",null),w=T.exports,M=o("c884");o("f9d4"),o("693d8"),o("9b74"),o("f6b6"),o("3c98"),o("cc10"),o("31c5");var I={components:{ResourceModel:b,ScriptSelectModel:w,codemirror:M["codemirror"]},props:{ruleId:{type:String,default:void 0}},data:function(){return{modal:{sourceResource:{},destResourceList:[{}],analysisMode:"WITHOUT",ignoreNullValue:!1},url:{add:"/api/rule/add",update:"/api/rule/update",info:"/api/rule/info"},rules:{ruleName:[{required:!0,message:"请输入规则名称",trigger:"blur"}],analysisMode:[{required:!0,message:"请选择解析方式",trigger:"blur"}],ignoreNullValue:[{required:!0,message:"请选择是否忽略空值",trigger:"blur"}]},resourceTypeMap:{MQTT:"MQTT Broker"},options:{mode:{name:"text/javascript",json:!0},height:150,lineNumbers:!0,tabSize:2,theme:"base16-light",line:!0,autoCloseTags:!0,lineWrapping:!0,styleActiveLine:!0,extraKeys:{"Ctrl-Space":"autocomplete"},hintOptions:{tables:{}}},defaultScript:"/**\n * 方法名transform不可修改,入参：data Object 源数据,出参：data Object 目标数据\n */\nfunction transform(data) {\n    return data;\n}",dataFormatMap:{MQTT:'{\n  "topic":String,\n  "payload":String\n}'}}},mounted:function(){var e=this;this.ruleId&&Object(a["a"])(this.url.info,{ruleId:this.ruleId}).then((function(t){var o=t.data;o&&(e.modal=t.data,e.modal.destResourceList.unshift({}))}))},methods:{addResource:function(e){this.$refs.ResourceModel.add(e)},editResource:function(e,t,o){this.$refs.ResourceModel.edit(e,t,o)},deleteResource:function(e,t){"dest"===e?this.modal.destResourceList.splice(t,1):"source"===e&&(this.modal.sourceResource={})},handleAddResource:function(e,t){"dest"===e?this.modal.destResourceList.push(t):"source"===e&&(this.modal.sourceResource=t)},handleUpdateResource:function(e,t,o){"dest"===e?this.modal.destResourceList[o]=t:"source"===e&&(this.modal.sourceResource={})},analysisModeChange:function(e){"SCRIPT"!==e||this.modal.script?this.modal.script="":this.modal.script=this.defaultScript},saveRule:function(){var e=this,t=this;this.$refs.ruleForm.validate((function(o){if(!o)return!1;t.confirmLoading=!0;var r,s=JSON.parse(JSON.stringify(e.modal));s.destResourceList.splice(0,1),r=e.ruleId?Object(a["c"])(e.url.update,s):Object(a["b"])(e.url.add,s),r.then((function(e){200===e.code?(t.$message.success(e.message),t.onClose()):t.$message.warning(e.message)})).finally((function(){t.confirmLoading=!1,t.onClose()}))}))},selectScript:function(){this.$refs.ScriptSelectModel.show()},handleSelectedScript:function(e){this.modal.script=e.scriptContent},onClose:function(){this.$router.push({name:"ruleList"})}}},S=I,k=(o("1871"),Object(p["a"])(S,r,s,!1,null,null,null));t["default"]=k.exports}}]);