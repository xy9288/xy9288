(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-39f8a3bd"],{"1e0e":function(t,e,r){"use strict";r.r(e);r("a4d3"),r("e01a"),r("b0c0");var a=function(){var t=this,e=t._self._c;return e("div",[e("a-card",{staticStyle:{"margin-bottom":"24px"},attrs:{bordered:!1,"body-style":{padding:"17px 24px"}}},[e("a-row",[e("a-col",{staticStyle:{"font-size":"16px","font-weight":"bold",color:"rgba(0, 0, 0, 0.85)","padding-top":"4px"},attrs:{span:12}},[t._v(" "+t._s(t.rule.ruleName)+" "),t.rule.enable?e("a-tag",{staticStyle:{"margin-left":"10px"},attrs:{color:"green"}},[t._v(" 运行中 ")]):t._e()],1),e("a-col",{staticStyle:{"text-align":"right"},attrs:{span:12}},[e("a-space",{attrs:{size:"small"}},[e("a-button",{staticStyle:{width:"75px"},on:{click:t.refresh}},[t._v(" 刷新")]),e("a-button",{staticStyle:{width:"75px"},attrs:{type:"danger"},on:{click:t.resetRuntime}},[t._v(" 重置")]),e("a-button",{staticStyle:{width:"75px"},attrs:{type:"primary"},on:{click:t.onClose}},[t._v(" 返回")])],1)],1)],1)],1),e("a-card",{staticStyle:{"margin-bottom":"24px"},attrs:{bordered:!1}},[e("a-row",[e("a-col",{attrs:{span:3}},[e("a-statistic",{attrs:{title:"累计总数",value:t.runtime.total}})],1),e("a-col",{attrs:{span:3}},[e("a-statistic",{attrs:{title:"转换成功",value:t.runtime.transformSuccessCount}})],1),e("a-col",{attrs:{span:3}},[e("a-statistic",{attrs:{title:"发送成功",value:t.runtime.publishSuccessCount}})],1),e("a-col",{attrs:{span:3}},[e("a-statistic",{attrs:{title:"转换失败",value:t.runtime.transformFailCount}})],1),e("a-col",{attrs:{span:3}},[e("a-statistic",{attrs:{title:"发送失败",value:t.runtime.publishFailCount}})],1),e("a-col",{attrs:{span:4}},[e("a-statistic",{attrs:{title:"最近执行",value:t.runtime.lastTime?t.runtime.lastTime:"—","value-style":{fontSize:"21px"}}})],1),e("a-col",{attrs:{span:5}},[e("a-statistic",{attrs:{title:"启动时间",value:t.runtime.startTime?t.runtime.startTime:"—","value-style":{fontSize:"21px"}}})],1)],1)],1),e("a-card",{staticStyle:{"margin-bottom":"24px"},attrs:{bordered:!1}},[e("a-descriptions",{attrs:{title:"规则信息",column:2}},[e("a-descriptions-item",{attrs:{label:"规则名称"}},[t._v(t._s(t.rule.ruleName))]),e("a-descriptions-item",{attrs:{label:"忽略空值"}},[t._v(t._s(!0===t.rule.ignoreNullValue?"是":"否"))]),e("a-descriptions-item",{attrs:{label:"转换方式"}},["SCRIPT"===t.rule.transformMode?e("span",[e("a",{on:{click:t.showScript}},[t._v(t._s(t.transformModeMap[t.rule.transformMode]))])]):e("span",[t._v(t._s(t.transformModeMap[t.rule.transformMode]))])]),e("a-descriptions-item",{attrs:{label:"备注"}},[t._v(" "+t._s(t.rule.description?t.rule.description:"无"))])],1)],1),e("a-card",{staticStyle:{"margin-bottom":"24px"},attrs:{bordered:!1}},[e("div",{staticClass:"title"},[t._v("数据源")]),t.rule.sourceResource?e("a-row",{staticStyle:{"background-color":"#f6f6f6",padding:"15px 10px 0 15px"}},[e("a-col",{attrs:{span:18}},[e("a-descriptions",{attrs:{column:2}},[e("a-descriptions-item",{attrs:{label:"资源名称"}},[t._v(" "+t._s(t.rule.sourceResource.resourceName)+" ")]),e("a-descriptions-item",{attrs:{label:"资源类型"}},[t._v(" "+t._s(t.resourceTypeMap[t.rule.sourceResource.resourceType])+" ")]),t._l(t.getDetails(t.rule.sourceResource),(function(r,a){return e("a-descriptions-item",{key:a,attrs:{label:r.name}},[t._v(" "+t._s(r.value)+" ")])}))],2)],1)],1):t._e()],1),e("a-card",{staticStyle:{"margin-bottom":"24px"},attrs:{bordered:!1,"body-style":{paddingBottom:"10px"}}},[e("div",{staticClass:"title"},[t._v("目标资源")]),t.rule.destResourceList&&t.rule.destResourceList.length>0?e("a-list",{attrs:{grid:{gutter:24,xs:1,sm:1,md:1,lg:1,xl:1,xxl:1},"data-source":t.rule.destResourceList},scopedSlots:t._u([{key:"renderItem",fn:function(r,a){return e("a-list-item",{},[e("a-row",{staticStyle:{"background-color":"#f6f6f6",padding:"15px 10px 0 15px"}},[e("a-col",{attrs:{span:18}},[e("a-descriptions",{attrs:{column:2}},[e("a-descriptions-item",{attrs:{label:"资源名称"}},[t._v(" "+t._s(r.resourceName)+" ")]),e("a-descriptions-item",{attrs:{label:"资源类型"}},[t._v(" "+t._s(t.resourceTypeMap[r.resourceType])+" ")]),t._l(t.getDetails(r),(function(r,a){return e("a-descriptions-item",{key:a,attrs:{label:r.name}},[t._v(" "+t._s(r.value)+" ")])}))],2)],1)],1)],1)}}],null,!1,994618230)}):t._e()],1),t.variables.length>0?e("a-card",{staticStyle:{"margin-bottom":"24px"},attrs:{bordered:!1}},[e("div",{staticClass:"title"},[t._v("环境变量")]),e("a-table",{staticStyle:{"margin-bottom":"20px"},attrs:{columns:t.varColumns,"data-source":t.variables,size:"middle",pagination:!1}})],1):t._e(),e("a-card",{staticStyle:{"margin-bottom":"24px"},attrs:{bordered:!1}},[e("div",{staticClass:"title"},[t._v(" 最近数据 "),e("span",{staticStyle:{cursor:"pointer"},on:{click:t.refresh}},[e("a-icon",{attrs:{type:"redo"}})],1)]),e("a-table",{attrs:{columns:t.dataColumns,"data-source":t.runtime.lastData,size:"middle",pagination:!1},scopedSlots:t._u([{key:"receiveData",fn:function(r){return e("span",{},[t._v(" "+t._s(r||"—")+" ")])}},{key:"transformSuccess",fn:function(r,a){return e("span",{},[e("a-popover",{attrs:{title:"转换结果"}},[e("template",{slot:"content"},[t._v(" "+t._s(a.transformData?a.transformData:"—")+" ")]),e("span",{staticStyle:{cursor:"pointer"}},[!0===r?e("a-badge",{attrs:{color:"green",text:"成功"}}):t._e(),!1===r?e("a-badge",{attrs:{color:"red",text:"失败"}}):t._e()],1)],2)],1)}},{key:"publishSuccess",fn:function(r,a){return e("span",{},[e("a-popover",{attrs:{title:"发送数据"}},[e("template",{slot:"content"},[t._v(" "+t._s(a.publishData?a.publishData:"—")+" ")]),e("span",{staticStyle:{cursor:"pointer"}},[!0===r?e("a-badge",{attrs:{color:"green",text:"成功"}}):t._e(),!1===r?e("a-badge",{attrs:{color:"red",text:"失败"}}):t._e()],1)],2)],1)}}])})],1),e("script-view-model",{ref:"ScriptViewModel"})],1)},n=[],o=(r("b64b"),r("0fea")),i=r("56fc"),s=r("8e45"),c=function(){var t=this,e=t._self._c;return e("a-modal",{attrs:{title:"解析脚本",width:900,visible:t.visible,bodyStyle:{padding:0},footer:null},on:{cancel:t.onClose}},[e("div",{staticClass:"scriptView"},[e("monaco-editor",{ref:"MonacoEditor",attrs:{"read-only":!0,height:"500px",border:!1,minimap:!0}})],1)])},p=[],u=r("2200c"),l={name:"ScriptViewModel",components:{MonacoEditor:u["a"]},data:function(){return{visible:!1}},methods:{show:function(t){var e=this;this.visible=!0,this.$nextTick((function(){e.$refs.MonacoEditor.set(t)}))},onClose:function(){this.visible=!1}}},m=l,d=r("2877"),f=Object(d["a"])(m,c,p,!1,null,null,null),v=f.exports,b={components:{ScriptViewModel:v},data:function(){return{url:{runtime:"/api/runtime/info",rule:"/api/rule/info",reset:"/api/runtime/reset"},rule:{},runtime:{},variables:[],transformModeMap:s["b"],resourceTypeMap:i["c"],dataColumns:[{title:"时间",dataIndex:"time"},{title:"接收数据",dataIndex:"receiveData",scopedSlots:{customRender:"receiveData"}},{title:"转换",dataIndex:"transformSuccess",scopedSlots:{customRender:"transformSuccess"}},{title:"发送",dataIndex:"publishSuccess",scopedSlots:{customRender:"publishSuccess"}},{title:"说明",dataIndex:"message"}],varColumns:[{title:"变量名称",dataIndex:"name",width:"30%"},{title:"初始值",dataIndex:"initValue"},{title:"当前值",dataIndex:"value"}]}},mounted:function(){this.ruleId=this.$route.params.ruleId,this.getInfo()},computed:{title:function(){return this.$route.meta.title}},methods:{showScript:function(){this.$refs.ScriptViewModel.show(this.rule.script)},refresh:function(){this.getInfo(),this.$message.success("刷新成功")},resetRuntime:function(){var t=this;this.$confirm({title:"重置运行状态?",content:"此操作将会清空运行统计数据、还原变量初始值",onOk:function(){Object(o["a"])(t.url.reset,{ruleId:t.ruleId}).then((function(e){200===e.code?(t.getInfo(),t.$message.success("重置成功")):t.$message.error("重置失败")}))}})},getInfo:function(){var t=this;this.ruleId&&Object(o["a"])(this.url.rule,{ruleId:this.ruleId}).then((function(e){t.rule=e.data,t.rule&&Object(o["a"])(t.url.runtime,{ruleId:t.ruleId}).then((function(e){if(t.runtime=e.data,t.variables=[],t.rule.variables)for(var r=Object.keys(t.rule.variables),a=0,n=r;a<n.length;a++){var o=n[a];t.variables.push({name:o,value:t.runtime.variables[o],initValue:t.rule.variables[o]})}}))}))},onClose:function(){this.$router.push({name:"ruleList"})},getDetails:function(t){return Object(i["a"])(t,"rule")}}},y=b,S=(r("b13f"),Object(d["a"])(y,a,n,!1,null,"6566a696",null));e["default"]=S.exports},"56fc":function(t,e,r){"use strict";r.d(e,"c",(function(){return p})),r.d(e,"b",(function(){return u})),r.d(e,"a",(function(){return l}));var a=r("b85c"),n=(r("99af"),r("b0c0"),r("995a")),o="all",i="source",s={MQTT:{name:"MQTT Broker",type:o,details:{resource:{name:"资源地址",format:function(t){return t.properties.url}},rule:[{name:"资源地址",format:function(t){return t.properties.url}},{name:"Topic",format:function(t){return t.properties.topic}}]}},KAFKA:{name:"Kafka",type:o,details:{resource:{name:"资源地址",format:function(t){return"".concat(t.properties.url)}},rule:[{name:"资源地址",format:function(t){return"".concat(t.properties.url)}},{name:"Topic",format:function(t){return t.properties.topic}}]}},MYSQL:{name:"MySQL",type:o,details:{resource:{name:"资源地址",format:function(t){return"".concat(t.properties.ip,":").concat(t.properties.port,"/").concat(t.properties.databaseName)}},rule:[{name:"资源地址",format:function(t){return"".concat(t.properties.ip,":").concat(t.properties.port,"/").concat(t.properties.databaseName)}},{name:"SQL模板",format:function(t){return t.properties.sql}},{name:"启动延迟",format:function(t){return t.properties.initialDelay?"".concat(t.properties.initialDelay).concat(n["b"][t.properties.timeUnit]):void 0}},{name:"查询频率",format:function(t){return t.properties.period?"".concat(t.properties.period).concat(n["b"][t.properties.timeUnit]):void 0}}]}},POSTGRESQL:{name:"PostgreSQL",type:o,details:{resource:{name:"资源地址",format:function(t){return"".concat(t.properties.ip,":").concat(t.properties.port,"/").concat(t.properties.databaseName)}},rule:[{name:"资源地址",format:function(t){return"".concat(t.properties.ip,":").concat(t.properties.port,"/").concat(t.properties.databaseName)}},{name:"SQL模板",format:function(t){return t.properties.sql}},{name:"启动延迟",format:function(t){return t.properties.initialDelay?"".concat(t.properties.initialDelay).concat(n["b"][t.properties.timeUnit]):void 0}},{name:"查询频率",format:function(t){return t.properties.period?"".concat(t.properties.period).concat(n["b"][t.properties.timeUnit]):void 0}}]}},SQLSERVER:{name:"SQL Server",type:o,details:{resource:{name:"资源地址",format:function(t){return"".concat(t.properties.ip,":").concat(t.properties.port,"/").concat(t.properties.databaseName)}},rule:[{name:"资源地址",format:function(t){return"".concat(t.properties.ip,":").concat(t.properties.port,"/").concat(t.properties.databaseName)}},{name:"SQL模板",format:function(t){return t.properties.sql}},{name:"启动延迟",format:function(t){return t.properties.initialDelay?"".concat(t.properties.initialDelay).concat(n["b"][t.properties.timeUnit]):void 0}},{name:"查询频率",format:function(t){return t.properties.period?"".concat(t.properties.period).concat(n["b"][t.properties.timeUnit]):void 0}}]}},TDENGINE:{name:"TDengine",type:o,details:{resource:{name:"资源地址",format:function(t){return"".concat(t.properties.ip,":").concat(t.properties.port,"/").concat(t.properties.databaseName)}},rule:[{name:"资源地址",format:function(t){return"".concat(t.properties.ip,":").concat(t.properties.port,"/").concat(t.properties.databaseName)}},{name:"SQL模板",format:function(t){return t.properties.sql}},{name:"启动延迟",format:function(t){return t.properties.initialDelay?"".concat(t.properties.initialDelay).concat(n["b"][t.properties.timeUnit]):void 0}},{name:"查询频率",format:function(t){return t.properties.period?"".concat(t.properties.period).concat(n["b"][t.properties.timeUnit]):void 0}}]}},HTTP:{name:"HTTP",type:o,details:{resource:{name:"资源地址",format:function(t){return"".concat(t.properties.url)}},rule:[{name:"请求路径",format:function(t){return"".concat(t.properties.url).concat(t.properties.path)}},{name:"请求方式",format:function(t){return"".concat(t.properties.method)}},{name:"启动延迟",format:function(t){return t.properties.initialDelay?"".concat(t.properties.initialDelay).concat(n["b"][t.properties.timeUnit]):void 0}},{name:"调用频率",format:function(t){return t.properties.period?"".concat(t.properties.period).concat(n["b"][t.properties.timeUnit]):void 0}}]}},OPCUA:{name:"OPC UA",type:i,details:{resource:{name:"资源地址",format:function(t){return"".concat(t.properties.url)}},rule:[{name:"资源地址",format:function(t){return"".concat(t.properties.url)}},{name:"读取点位",format:function(t){return"".concat(t.properties.points?t.properties.points.length:0)}}]}},REDIS:{name:"Redis",type:o,details:{resource:{name:"资源地址",format:function(t){return"STANDALONE"===t.properties.mode?"".concat(t.properties.ip,":").concat(t.properties.port):"".concat(t.properties.nodes)}},rule:[{name:"资源地址",format:function(t){return"STANDALONE"===t.properties.mode?"".concat(t.properties.ip,":").concat(t.properties.port):"".concat(t.properties.nodes)}},{name:"执行命令",format:function(t){return"".concat(t.properties.command)}},{name:"启动延迟",format:function(t){return t.properties.initialDelay?"".concat(t.properties.initialDelay).concat(n["b"][t.properties.timeUnit]):void 0}},{name:"调用频率",format:function(t){return t.properties.period?"".concat(t.properties.period).concat(n["b"][t.properties.timeUnit]):void 0}}]}}};function c(){var t={};for(var e in s)t[e]=s[e].name;return t}var p=c();function u(t){var e=[];for(var r in s){var a=s[r].type;if(!t||a===o||a===t){var n={name:s[r].name,code:r,type:a};e.push(n)}}return e}function l(t,e){if(!t||!t.resourceType)return"resource"===e?{name:"",value:""}:[{name:"",value:""}];var r=s[t.resourceType],n=r.details[e];if("resource"===e){var o=n.format(t);return o?{name:n.name,value:o}:{name:"",value:""}}var i,c=[],p=Object(a["a"])(n);try{for(p.s();!(i=p.n()).done;){var u=i.value,l=u.format(t);l&&c.push({name:u.name,value:l})}}catch(m){p.e(m)}finally{p.f()}return c}},"62a7":function(t,e,r){},"8e45":function(t,e,r){"use strict";r.d(e,"b",(function(){return a})),r.d(e,"a",(function(){return o}));var a={WITHOUT:"无转换透传",SCRIPT:"JS脚本转换",PLUGIN:"插件转换"};function n(){var t=[];for(var e in a)t.push({name:a[e],value:e});return t}var o=n()},"995a":function(t,e,r){"use strict";r.d(e,"b",(function(){return a})),r.d(e,"a",(function(){return o}));var a={SECONDS:"秒",MINUTES:"分",HOURS:"时",DAYS:"天"};function n(){var t=[];for(var e in a)t.push({name:a[e],value:e});return t}var o=n()},b13f:function(t,e,r){"use strict";r("62a7")}}]);