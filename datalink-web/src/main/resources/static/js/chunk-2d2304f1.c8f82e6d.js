(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d2304f1"],{ec74:function(t,e,a){"use strict";a.r(e);a("a4d3"),a("e01a");var o=function(){var t=this,e=t._self._c;return e("div",[e("a-form-model",{ref:"ruleForm",attrs:{model:t.modal,layout:"vertical",rules:t.rules}},[e("a-card",{staticStyle:{"margin-bottom":"20px"},attrs:{bordered:!1,"body-style":{padding:"17px 24px"}}},[e("a-row",[e("a-col",{staticStyle:{"font-size":"16px","font-weight":"bold",color:"rgba(0, 0, 0, 0.85)","padding-top":"4px"},attrs:{span:12}},[t._v(" "+t._s(t.modal.scriptId?"编辑":"新建")+"脚本 ")]),e("a-col",{staticStyle:{"text-align":"right"},attrs:{span:12}},[e("a-space",{attrs:{size:"small"}},[e("a-popconfirm",{attrs:{title:"放弃未保存的内容?",placement:"bottom"},on:{confirm:function(){t.onClose()}}},[e("a-button",{staticStyle:{width:"75px"}},[t._v(" 返回")])],1),e("a-button",{staticStyle:{width:"95px"},on:{click:t.changeOpenTest}},[t._v(" "+t._s(t.openTest?"关闭":"开启")+"调试")]),e("a-button",{staticStyle:{width:"75px"},attrs:{type:"primary"},on:{click:t.saveScript}},[t._v(" 保存")])],1)],1)],1)],1),e("a-row",{attrs:{gutter:24}},[e("a-col",{attrs:{span:t.openTest?16:24}},[e("a-card",{attrs:{bordered:!1,"body-style":{paddingBottom:0}}},[e("a-row",{attrs:{gutter:24}},[e("a-col",{attrs:{span:9}},[e("a-form-model-item",{attrs:{label:"名称",prop:"scriptName"}},[e("a-input",{attrs:{placeholder:"请输入脚本名称"},model:{value:t.modal.scriptName,callback:function(e){t.$set(t.modal,"scriptName",e)},expression:"modal.scriptName"}})],1)],1),e("a-col",{attrs:{span:9}},[e("a-form-model-item",{attrs:{label:"说明",prop:"description"}},[e("a-input",{attrs:{placeholder:"请输入脚本说明"},model:{value:t.modal.description,callback:function(e){t.$set(t.modal,"description",e)},expression:"modal.description"}})],1)],1),e("a-col",{attrs:{span:6}},[e("a-form-model-item",{attrs:{label:"最后修改",prop:"description"}},[e("a-input",{attrs:{placeholder:"最后修改时间","read-only":!0},model:{value:t.modal.updateTime,callback:function(e){t.$set(t.modal,"updateTime",e)},expression:"modal.updateTime"}})],1)],1),e("a-col",{staticClass:"scriptModel",attrs:{span:24}},[e("a-form-model-item",{attrs:{label:"JavaScript脚本",prop:"scriptContent"}},[e("monaco-editor",{ref:"ScriptContentEditor",attrs:{height:"600px",minimap:!0}})],1)],1)],1)],1)],1),e("a-col",{directives:[{name:"show",rawName:"v-show",value:t.openTest,expression:"openTest"}],attrs:{span:8}},[e("a-card",{attrs:{title:"调试","body-style":{paddingBottom:0},bordered:!1}},[e("span",{attrs:{slot:"extra"},slot:"extra"},[e("a-button",{staticClass:"runBtn",attrs:{type:"primary",icon:"caret-right"},on:{click:t.runScript}},[t._v(" 运行 ")])],1),e("a-form-model-item",{staticClass:"inputModel",attrs:{label:"输入参数（Json）",prop:"paramContent"}},[e("monaco-editor",{ref:"ParamContentEditor",attrs:{height:"285px",language:"json"}})],1),e("a-form-model-item",{staticClass:"outputModel",attrs:{label:"运行结果",prop:"resultContent"}},[e("div",{staticStyle:{"margin-top":"-30px",width:"100%","text-align":"right",height:"30px",color:"#000000"}},[e("span",{directives:[{name:"show",rawName:"v-show",value:t.time>=0,expression:"time >= 0"}],staticStyle:{display:"inline-block","padding-right":"15px"}},[t._v("用时："+t._s(t.time)+"ms")])]),e("monaco-editor",{ref:"ResultContentEditor",attrs:{height:"285px",language:"json"}})],1)],1)],1)],1)],1)],1)},r=[],s=(a("d3b7"),a("0fea")),i=a("2200c"),n={name:"ResourceModel",components:{MonacoEditor:i["a"]},data:function(){return{title:"操作",visible:!1,confirmLoading:!1,modal:{scriptContent:"/**\n* 方法名transform不可修改,入参：data Object 源数据,出参：data Object 目标数据\n*/\nfunction transform(data) {\n    return data;\n}",paramContent:"{}",resultContent:""},url:{info:"/api/script/info",add:"/api/script/add",update:"/api/script/update",run:"/api/script/run"},rules:{scriptName:[{required:!0,message:"请输入脚本名称",trigger:"blur"}],scriptContent:[{required:!0,message:"请输入脚本内容",trigger:"blur"}]},time:-1,openTest:!1}},mounted:function(){var t=this,e=this.$route.params.scriptId;"new"!==e?(this.scriptId=e,Object(s["b"])(this.url.info,{scriptId:this.scriptId}).then((function(e){t.modal=e.data,t.setEditorValue()}))):this.setEditorValue()},methods:{setEditorValue:function(){this.$refs.ScriptContentEditor.set(this.modal.scriptContent),this.$refs.ParamContentEditor.set(this.modal.paramContent),this.$refs.ResultContentEditor.set(this.modal.resultContent)},getEditorValue:function(){this.modal.scriptContent=this.$refs.ScriptContentEditor.get(),this.modal.paramContent=this.$refs.ParamContentEditor.get(),this.modal.resultContent=this.$refs.ResultContentEditor.get()},runScript:function(){var t=this;this.getEditorValue(),Object(s["c"])(this.url.run,this.modal).then((function(e){200===e.code?(t.modal.resultContent=JSON.stringify(e.data.result),t.$refs.ResultContentEditor.set(t.modal.resultContent),t.time=e.data.time,t.$message.success("运行成功")):t.$message.error("运行失败: "+e.message)}))},saveScript:function(){var t=this;this.getEditorValue();var e=this;this.$refs.ruleForm.validate((function(a){if(!a)return!1;e.confirmLoading=!0;var o,r=JSON.parse(JSON.stringify(t.modal));o=t.scriptId?Object(s["d"])(t.url.update,r):Object(s["c"])(t.url.add,r),o.then((function(t){200===t.code?(e.$message.success("保存成功"),e.modal=t.data):e.$message.warning("保存失败")})).finally((function(){e.confirmLoading=!1}))}))},onClose:function(){this.$router.push({name:"scriptList"})},changeOpenTest:function(){this.openTest=!this.openTest}}},l=n,d=a("2877"),c=Object(d["a"])(l,o,r,!1,null,null,null);e["default"]=c.exports}}]);